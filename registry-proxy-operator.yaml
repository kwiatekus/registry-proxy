---
# Source: registry-proxy-operator/templates/namespace/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: registry-proxy
  labels:
        app.kubernetes.io/version: "main"
        helm.sh/chart: "0.1.0"
        app.kubernetes.io/name: registry-proxy-operator
        app.kubernetes.io/instance: registry-proxy-operator
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/part-of: registry-proxy
        kyma-project.io/module: "registry-proxy"
        app.kubernetes.io/component: operator
---
# Source: registry-proxy-operator/templates/rbac/service_account.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator
  namespace: map[create:true name:registry-proxy]
---
# Source: registry-proxy-operator/templates/busola/extension.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
    busola.io/extension: resource
    busola.io/extension-version: "0.5"
  name: registry-proxy-operator.kyma-project.io
  namespace: map[create:true name:registry-proxy]
data:
  general: |- 
    category: Kyma
    description: '{{[Registry Proxy custom resource](https://github.com/kyma-project/registry-proxy/tree/main/docs)}}
      defines the Registry Proxy module.'
    features:
      actions:
        disableCreate: true
        disableDelete: true
    name: Registry Proxy
    resource:
      group: operator.kyma-project.io
      kind: RegistryProxy
      version: v1alpha1
    scope: namespace
    urlPath: registryproxies
  details: |- 
    body:
    - defaultType: information
      filter: $matchEvents($$, $root.kind, $root.metadata.name)
      name: events
      widget: EventList
    header:
    - name: details.state
      source: status.state
      widget: Badge
    health: null
    status:
      body:
      - fullWidth: true
        name: status.conditions
        source: status.conditions
        widget: ConditionList
  list: |- 
    - name: list.state
      source: status.state
      widget: Badge
  translations: |- 
    en:
      details:
        state: State
      list:
        state: State
      status:
        conditions: Conditions
---
# Source: registry-proxy-operator/templates/crd/operator.kyma-project.io_registryproxies.yaml
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  annotations:
    "helm.sh/resource-policy": keep
    controller-gen.kubebuilder.io/version: v0.19.0
  name: registryproxies.operator.kyma-project.io
spec:
  group: operator.kyma-project.io
  names:
    kind: RegistryProxy
    listKind: RegistryProxyList
    plural: registryproxies
    singular: registryproxy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .metadata.creationTimestamp
      name: age
      type: date
    - jsonPath: .status.conditions[?(@.type=='Installed')].status
      name: Installed
      type: string
    - jsonPath: .status.conditions[?(@.type=='PrerequisitesSatisfied')].status
      name: Prerequisites Satisfied
      type: string
    - jsonPath: .status.state
      name: state
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: RegistryProxy is the Schema for the RegistryProxies API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: RegistryProxySpec defines the desired state of RegistryProxy.
            type: object
          status:
            description: RegistryProxyStatus defines the observed state of RegistryProxy.
            properties:
              conditions:
                description: Conditions associated with CustomStatus.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              served:
                description: |-
                  Served signifies that current RegistryProxy is managed.
                  Value can be one of ("True", "False").
                enum:
                - "True"
                - "False"
                type: string
              state:
                description: |-
                  State signifies current state of RegistryProxy.
                  Value can be one of ("Ready", "Processing", "Error", "Deleting").
                enum:
                - Processing
                - Deleting
                - Ready
                - Error
                - Warning
                type: string
            required:
            - served
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
# Source: registry-proxy-operator/templates/rbac/connection_admin_role.yaml
# This rule is not used by the project registry-proxy-operator itself.
# It is provided to allow the cluster admin to help manage permissions for users.
#
# Grants full permissions ('*') over operator.kyma-project.io.
# This role is intended for users authorized to modify roles and bindings within the cluster,
# enabling them to delegate specific permissions to other users or groups as needed.

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-admin-role
rules:
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies
  verbs:
  - '*'
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies/status
  verbs:
  - get
---
# Source: registry-proxy-operator/templates/rbac/connection_editor_role.yaml
# This rule is not used by the project registry-proxy-operator itself.
# It is provided to allow the cluster admin to help manage permissions for users.
#
# Grants permissions to create, update, and delete resources within the operator.kyma-project.io.
# This role is intended for users who need to manage these resources
# but should not control RBAC or manage permissions for others.

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-editor-role
rules:
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies/status
  verbs:
  - get
---
# Source: registry-proxy-operator/templates/rbac/connection_viewer_role.yaml
# This rule is not used by the project registry-proxy-operator itself.
# It is provided to allow the cluster admin to help manage permissions for users.
#
# Grants read-only access to operator.kyma-project.io resources.
# This role is intended for users who need visibility into these resources
# without permissions to modify them. It is ideal for monitoring purposes and limited-access viewing.

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-viewer-role
rules:
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies/status
  verbs:
  - get
---
# Source: registry-proxy-operator/templates/rbac/metrics_auth_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-metrics-auth-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
# Source: registry-proxy-operator/templates/rbac/metrics_reader_role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-metrics-reader
rules:
- nonResourceURLs:
  - "/metrics"
  verbs:
  - get
---
# Source: registry-proxy-operator/templates/rbac/role.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-role
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  - secrets
  - serviceaccounts
  - services
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apiextensions.k8s.io
  resources:
  - customresourcedefinitions
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps
  resources:
  - daemonsets
  - deployments
  - deployments/status
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - apps
  resources:
  - replicasets
  verbs:
  - list
- apiGroups:
  - apps
  resources:
  - statefulsets
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies/finalizers
  verbs:
  - update
- apiGroups:
  - operator.kyma-project.io
  resources:
  - registryproxies/status
  verbs:
  - get
  - patch
  - update
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - clusterrolebindings
  - clusterroles
  - rolebindings
  - roles
  verbs:
  - bind
  - create
  - delete
  - escalate
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - registry-proxy.kyma-project.io
  resources:
  - connections
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - registry-proxy.kyma-project.io
  resources:
  - connections/status
  verbs:
  - get
- apiGroups:
  - scheduling.k8s.io
  resources:
  - priorityclasses
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
---
# Source: registry-proxy-operator/templates/rbac/metrics_auth_role_binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-metrics-auth-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: registry-proxy-operator-metrics-auth-role
subjects:
- kind: ServiceAccount
  name: registry-proxy-operator
  namespace: map[create:true name:registry-proxy]
---
# Source: registry-proxy-operator/templates/rbac/role_binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  name: registry-proxy-operator-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: registry-proxy-operator-role
subjects:
- kind: ServiceAccount
  name: registry-proxy-operator
  namespace: map[create:true name:registry-proxy]
---
# Source: registry-proxy-operator/templates/rbac/leader_election_role.yaml
# permissions to do leader election.
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  namespace: map[create:true name:registry-proxy]
  name: registry-proxy-operator-leader-election-role
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
# Source: registry-proxy-operator/templates/rbac/leader_election_role_binding.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
  namespace: map[create:true name:registry-proxy]
  name: registry-proxy-operator-leader-election-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: registry-proxy-operator-leader-election-role
subjects:
- kind: ServiceAccount
  name: registry-proxy-operator
  namespace: map[create:true name:registry-proxy]
---
# Source: registry-proxy-operator/templates/metrics/metrics-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: registry-proxy-operator-metrics-service
  namespace: map[create:true name:registry-proxy]
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
spec:
  ports:
    - port: 8080
      targetPort: 8080
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
---
# Source: registry-proxy-operator/templates/manager/manager.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: registry-proxy-operator
  namespace: map[create:true name:registry-proxy]
  labels:
    app.kubernetes.io/version: "main"
    helm.sh/chart: "0.1.0"
    app.kubernetes.io/name: registry-proxy-operator
    app.kubernetes.io/instance: registry-proxy-operator
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: registry-proxy
    kyma-project.io/module: "registry-proxy"
    app.kubernetes.io/component: operator
    control-plane: controller-manager
spec:
  replicas:  1
  selector:
    matchLabels:
      app.kubernetes.io/name: registry-proxy-operator
      app.kubernetes.io/instance: registry-proxy-operator
      control-plane: controller-manager
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: registry-proxy-operator
      labels:
        app.kubernetes.io/version: "main"
        helm.sh/chart: "0.1.0"
        app.kubernetes.io/name: registry-proxy-operator
        app.kubernetes.io/instance: registry-proxy-operator
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/part-of: registry-proxy
        kyma-project.io/module: "registry-proxy"
        app.kubernetes.io/component: operator
        control-plane: controller-manager
        sidecar.istio.io/inject: "false"
    spec:
      containers:
        - name: registry-proxy-operator
          args:
            - --leader-elect
            - --metrics-bind-address=:8080
            - --health-probe-bind-address=:8081
          command:
            - /operator
          image: europe-docker.pkg.dev/kyma-project/dev/registry-proxy-operator:PR-36
          env:
            - name: DOCKERREGISTRY_MANAGER_UID
              valueFrom:
                fieldRef:
                  fieldPath: metadata.uid
            - name: IMAGE_CONNECTION
              value: europe-docker.pkg.dev/kyma-project/prod/registry-proxy-connection:main
            - name: IMAGE_REGISTRY_PROXY
              value: europe-docker.pkg.dev/kyma-project/prod/registry-proxy-controller:main
          livenessProbe:
            httpGet:
              path: /healthz
              port: 8081
            initialDelaySeconds: 15
            periodSeconds: 20
          readinessProbe:
            httpGet:
              path: /readyz
              port: 8081
            initialDelaySeconds: 5
            periodSeconds: 10
          resources:
            limits:
              cpu: 500m
              memory: 128Mi
            requests:
              cpu: 5m
              memory: 64Mi
          securityContext:
            allowPrivilegeEscalation: false
            capabilities:
              drop:
              - ALL
      securityContext:
        runAsNonRoot: true
        seccompProfile:
          type: RuntimeDefault
      serviceAccountName: registry-proxy-operator
      terminationGracePeriodSeconds: 10
